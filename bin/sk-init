#!/usr/bin/env node

const fs = require('fs');
const lodash = require('lodash');
const mkdirp = require('mkdirp');
const path = require('path');

const pkg = require(path.join(process.cwd(), 'package.json'));
const initDir = path.join(__dirname, '..', 'init');
const files = [
  // Base editor / git config.
  '.editorconfig',
  '.eslintrc',
  '.npmignore',

  // Tooling config.
  './karma.conf.js',
  './rollup.config.js',
  './sauce.browsers.js',
  './webpack.conf.js',
  '.travis.yml',

  // Metadata.
  'LICENSE',
  'README.md',

  // Source.
  'src/index.js',
  'test/perf.js',
  'test/unit.js',
];

files.forEach(file => {
  let dstFile = file;

  if (dstFile === '.gitignore') {
    dstFile = '.npmignore';
  }

  const src = path.join(initDir, file);
  const dst = path.join(process.cwd(), dstFile);

  fs.readFile(src, (err, content) => {
    fs.exists(dst, exists => {
      if (!exists) {
        mkdirp(path.dirname(dst), () => {
          fs.writeFile(dst, lodash.template(content)(pkg));
        });
      }
    });
  });
});
